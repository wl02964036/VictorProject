"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[378],{2378:(w,g,i)=>{i.r(g),i.d(g,{LoginModule:()=>M});var m=i(6895),l=i(1387),e=i(8256),d=i(262),p=i(9646),h=i(529);let f=(()=>{class t{constructor(o){this.http=o,this.url="/angular/login"}jwtLogin(o){return this.http.post(`${this.url}`,o).pipe((0,d.K)(n=>(console.error("\u5e33\u865f\u767b\u5165\u5931\u6557",n),(0,p.of)({status:"error",message:"\u5e33\u865f\u767b\u5165\u5931\u6557"}))))}}return t.\u0275fac=function(o){return new(o||t)(e.LFG(h.eN))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),v=(()=>{class t{constructor(o){this.http=o,this.url="/angular"}reloadCaptcha(){return this.http.get(`${this.url}/reloadCaptcha`,{responseType:"text"}).pipe((0,d.K)(o=>(console.error("\u7121\u6cd5\u91cd\u65b0\u8f09\u5165\u9a57\u8b49\u78bc",o),(0,p.of)(""))))}playCaptchaAudio(){return this.http.get("/angular/captchaNumber?t="+Date.now(),{responseType:"text"}).pipe((0,d.K)(o=>(console.error("\u7121\u6cd5\u64ad\u653e\u9a57\u8b49\u78bc\u8a9e\u97f3",o),(0,p.of)(""))))}}return t.\u0275fac=function(o){return new(o||t)(e.LFG(h.eN))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var a=i(433);function C(t,r){if(1&t){const o=e.EpF();e.TgZ(0,"div",22)(1,"button",23),e.NdJ("click",function(){e.CHM(o);const c=e.oxw();return e.KtG(c.playCaptchaAudio())}),e._uU(2,"\u64ad\u653e"),e.qZA()()}}function y(t,r){1&t&&(e.TgZ(0,"div",22),e._UZ(1,"audio",24),e.qZA())}const A=[{path:"",component:(()=>{class t{constructor(o,n,c,u){this.router=o,this.loginApiService=n,this.captchaApiService=c,this.renderer=u,this.loginValue={username:"",password:"",captcha:""},this.errorMessage=null,this.loggedOut=!1,this.isIE=!1,this.reloadCaptcha()}ngOnInit(){this.renderer.addClass(document.body,"bg-gradient-primary"),this.detectIE();const o=new URLSearchParams(window.location.search);o.has("logout")?this.errorMessage="\u60a8\u5df2\u7d93\u767b\u51fa":o.has("error")&&(this.errorMessage=o.get("error")),window.top!==window.self&&(window.top.location.href=window.location.href),$("#loginForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(n){return n.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}ngOnDestroy(){this.renderer.removeClass(document.body,"bg-gradient-primary")}detectIE(){const o=window.navigator.userAgent;this.isIE=o.indexOf("MSIE")>-1||o.indexOf("Trident")>-1}reloadCaptcha(){this.captchaApiService.reloadCaptcha().subscribe(()=>{document.getElementById("captchaImg").src=`/angular/captchaImage?t=${Date.now()}`,document.getElementById("captchaAudioWav").src="/angular/captchaAudio"})}playCaptchaAudio(){this.captchaApiService.playCaptchaAudio().subscribe(o=>{window.open(`/wav/${o}.wav`,"_blank")})}onSubmit(o){o.valid&&this.loginApiService.jwtLogin(this.loginValue).subscribe(n=>{"success"===n.status?(localStorage.setItem("token",n.token),localStorage.setItem("systemUser",JSON.stringify(n.systemUser)),localStorage.setItem("sidebarMenus",JSON.stringify(n.sidebarMenus)),this.router.navigateByUrl("/manage")):this.errorMessage=n.message})}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(l.F0),e.Y36(f),e.Y36(v),e.Y36(e.Qsj))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-login"]],decls:28,vars:6,consts:[[1,"container"],[1,"row","justify-content-center"],[1,"col-xl-10","col-lg-12","col-md-9"],[1,"card","o-hidden","border-0","shadow-lg","my-5"],[1,"card-body","p-0"],[1,"row"],[1,"col-lg-6","d-none","d-lg-block","bg-login-image",2,"min-height","420px"],[1,"col-lg-5"],[1,"p-5"],[1,"text-center"],[1,"h4","text-primary","mb-4"],["id","loginForm",1,"user",3,"ngSubmit"],["loginForm","ngForm"],[1,"form-group"],["type","text","name","username","placeholder","\u8acb\u8f38\u5165\u5e33\u865f","required","",1,"form-control","form-control-user",3,"ngModel","ngModelChange"],["type","password","name","password","placeholder","\u8acb\u8f38\u5165\u5bc6\u78bc","required","","autocomplete","off",1,"form-control","form-control-user",3,"ngModel","ngModelChange"],["type","text","name","captcha","placeholder","\u8acb\u8f38\u5165\u4e0b\u65b9\u9a57\u8b49\u78bc","required","",1,"form-control","form-control-user",3,"ngModel","ngModelChange"],["type","submit",1,"btn","btn-primary","btn-user","btn-block"],["id","captchaImage",1,"form-group","mt-3"],["id","captchaImg","width","96","height","43","alt","\u5716\u5f62\u9a57\u8b49\u78bc"],["id","captchaAudio","class","form-group",4,"ngIf"],["type","button",1,"btn","btn-info","mb-3",3,"click"],["id","captchaAudio",1,"form-group"],["type","button",1,"btn","btn-secondary",3,"click"],["id","captchaAudioWav","controls","","type","audio/wav"]],template:function(o,n){if(1&o){const c=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"div",6),e.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"h1",10),e._uU(11),e.qZA()(),e.TgZ(12,"form",11,12),e.NdJ("ngSubmit",function(){e.CHM(c);const s=e.MAs(13);return e.KtG(n.onSubmit(s))}),e.TgZ(14,"div",13)(15,"input",14),e.NdJ("ngModelChange",function(s){return n.loginValue.username=s}),e.qZA()(),e.TgZ(16,"div",13)(17,"input",15),e.NdJ("ngModelChange",function(s){return n.loginValue.password=s}),e.qZA()(),e.TgZ(18,"div",13)(19,"input",16),e.NdJ("ngModelChange",function(s){return n.loginValue.captcha=s}),e.qZA()(),e.TgZ(20,"button",17),e._uU(21,"\u767b\u5165"),e.qZA(),e.TgZ(22,"div",18),e._UZ(23,"img",19),e.qZA(),e.YNc(24,C,3,0,"div",20),e.YNc(25,y,2,0,"div",20),e.TgZ(26,"button",21),e.NdJ("click",function(){return n.reloadCaptcha()}),e._uU(27,"\u91cd\u65b0\u7522\u751f\u9a57\u8b49\u78bc"),e.qZA()()()()()()()()()()}2&o&&(e.xp6(11),e.hij(" ",n.errorMessage?n.errorMessage:"\u6b61\u8fce\u56de\u4f86"," "),e.xp6(4),e.Q6J("ngModel",n.loginValue.username),e.xp6(2),e.Q6J("ngModel",n.loginValue.password),e.xp6(2),e.Q6J("ngModel",n.loginValue.captcha),e.xp6(5),e.Q6J("ngIf",n.isIE),e.xp6(1),e.Q6J("ngIf",!n.isIE))},dependencies:[m.O5,a._Y,a.Fj,a.JJ,a.JL,a.Q7,a.On,a.F]}),t})()}];let b=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[l.Bz.forChild(A),l.Bz]}),t})(),M=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[m.ez,b,a.u5]}),t})()}}]);
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[763],{7763:(G,c,d)=>{d.r(c),d.d(c,{OrganizationModule:()=>R});var u=d(6895),m=d(1387),e=d(8256),h=d(2812),_=d(529);let p=(()=>{class i{constructor(n){this.http=n,this.url="/angular/organization"}getMenuTree(n){return this.http.get("/angular/tree/organization",{params:{node:n}})}getUnitForUpdate(n){return this.http.get(`${this.url}/editUnit`,{params:{node:n}})}getUnitForCreate(n){return this.http.get(`${this.url}/newUnit`,{params:{node:n}})}checkUnitCodeRepeat(n){return this.http.get(`${this.url}/unitCodeRepeat`,{responseType:"text",params:{code:n}})}createUnit(n){return this.http.post(`${this.url}/createUnit`,n)}updateUnit(n){return this.http.post(`${this.url}/updateUnit`,n)}deleteUnit(n){return this.http.post(`${this.url}/destroyUnit`,null,{params:{code:n}})}getUserForUpdate(n){return this.http.get(`${this.url}/editUser`,{params:{node:n}})}getUserForCreate(n){return this.http.get(`${this.url}/newUser`,{params:{node:n}})}checkUsernameRepeat(n){return this.http.get(`${this.url}/usernameRepeat`,{responseType:"text",params:{username:n}})}createUser(n){return this.http.post(`${this.url}/createUser`,n)}updateUser(n){return this.http.post(`${this.url}/updateUser`,n)}deleteUser(n,t){return this.http.post(`${this.url}/destroyUser`,null,{params:{username:n,unitCode:t}})}getPasswordForUpdate(n){return this.http.get(`${this.url}/editPassword`,{params:{username:n}})}updatePassword(n){return this.http.post(`${this.url}/updatePassword`,n)}unlockErrorPassword(n){return this.http.post(`${this.url}/unlock`,null,{responseType:"text",params:{username:n}})}downloadReport(){return this.http.post(`${this.url}/report`,null,{responseType:"blob",headers:new _.WM({Accept:"application/vnd.ms-excel"})})}}return i.\u0275fac=function(n){return new(n||i)(e.LFG(_.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var l=d(433);function C(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",30)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",31),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",32),e._uU(5,"\xd7"),e.qZA()()()}if(2&i){const n=e.oxw();e.xp6(2),e.Oqu(n.message)}}let f=(()=>{class i{constructor(n){this.organizationApiService=n,this.switchComponent=new e.vpe,this.refreshTree=new e.vpe,this.message=null,this.messageChange=new e.vpe,this.unit={code:"",displayName:"",fax:"",email:"",tel:"",weight:0,parentCode:""},this.isInit=!1}ngOnInit(){this.isInit=!0,this.loadUnit(this.nodeId)}ngOnChanges(n){this.isInit&&this.loadUnit(this.nodeId)}ngAfterViewInit(){this.formInstance=$("#editUnitForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(t){return t.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}loadUnit(n){this.organizationApiService.getUnitForUpdate(n).subscribe(t=>{"success"===t.status?(this.originUnit={...t.unit},this.unit={...t.unit},this.formInstance&&this.formInstance.reset()):this.message=t.message})}onSubmit(){this.formInstance.validate()&&this.organizationApiService.updateUnit(this.unit).subscribe(n=>{this.message=n.message,this.refreshTree.emit({targetNodeId:`unit_${this.unit.code}`})})}onReset(n){this.unit={...this.originUnit},n.resetForm(this.unit),this.formInstance?.reset()}onDestroy(){confirm("\u78ba\u5b9a\u8981\u522a\u9664\u6b64\u55ae\u4f4d\uff1f")&&this.organizationApiService.deleteUnit(this.unit.code).subscribe(n=>{this.message=n.message,this.refreshTree.emit({targetNodeId:`unit_${this.unit.parentCode}`}),this.switchComponent.emit({newComponent:"editUnit",newNodeId:this.unit.parentCode})})}onNewUnit(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"newUnit",newNodeId:null})}onNewUser(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"newUser",newNodeId:null})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-edit-unit"]],inputs:{nodeId:"nodeId",message:"message"},outputs:{switchComponent:"switchComponent",refreshTree:"refreshTree",messageChange:"messageChange"},features:[e.TTD],decls:57,vars:7,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","toolbar","aria-label","\u529f\u80fd\u9078\u55ae\u7fa4",1,"btn-toolbar","float-right"],["role","group",1,"btn-group","mr-2"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body"],["id","editUnitForm","novalidate",""],["unitForm","ngForm"],[1,"form-group","required"],["for","code"],["id","code","name","code","type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-text","text-muted"],["for","displayName"],["id","displayName","name","displayName","type","text","required","","maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group"],["for","email"],["id","email","name","email","type","email","maxlength","256","data-parsley-type","email",1,"form-control",3,"ngModel","ngModelChange"],["for","fax"],["id","fax","name","fax","type","text","maxlength","128","pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["for","tel"],["id","tel","name","tel","type","text","maxlength","128","pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["for","weight"],["id","weight","name","weight","type","number",1,"form-control",3,"ngModel","ngModelChange"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"]],template:function(n,t){if(1&n){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u4fee\u6539\u55ae\u4f4d"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,C,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"h6",5)(7,"span"),e._uU(8,"\u55ae\u4f4d\u4fee\u6539"),e.qZA(),e.TgZ(9,"div",6)(10,"div",7)(11,"button",8),e.NdJ("click",function(){return t.onSubmit()}),e._uU(12,"\u5132\u5b58"),e.qZA(),e.TgZ(13,"button",9),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(24);return e.KtG(t.onReset(a))}),e._uU(14,"\u91cd\u586b"),e.qZA(),e.TgZ(15,"button",10),e.NdJ("click",function(){return t.onDestroy()}),e._uU(16,"\u522a\u9664"),e.qZA()(),e.TgZ(17,"div",7)(18,"button",11),e.NdJ("click",function(){return t.onNewUnit()}),e._uU(19,"\u65b0\u589e\u55ae\u4f4d"),e.qZA(),e.TgZ(20,"button",11),e.NdJ("click",function(){return t.onNewUser()}),e._uU(21,"\u65b0\u589e\u4eba\u54e1"),e.qZA()()()()(),e.TgZ(22,"div",12)(23,"form",13,14)(25,"div",15)(26,"label",16),e._uU(27,"\u55ae\u4f4d\u4ee3\u78bc"),e.qZA(),e.TgZ(28,"input",17),e.NdJ("ngModelChange",function(a){return t.unit.code=a}),e.qZA(),e.TgZ(29,"small",18),e._uU(30,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(31,"div",15)(32,"label",19),e._uU(33,"\u540d\u7a31"),e.qZA(),e.TgZ(34,"input",20),e.NdJ("ngModelChange",function(a){return t.unit.displayName=a}),e.qZA()(),e.TgZ(35,"div",21)(36,"label",22),e._uU(37,"\u96fb\u5b50\u90f5\u4ef6\u4fe1\u7bb1"),e.qZA(),e.TgZ(38,"input",23),e.NdJ("ngModelChange",function(a){return t.unit.email=a}),e.qZA()(),e.TgZ(39,"div",21)(40,"label",24),e._uU(41,"\u50b3\u771f\u865f\u78bc"),e.qZA(),e.TgZ(42,"input",25),e.NdJ("ngModelChange",function(a){return t.unit.fax=a}),e.qZA(),e.TgZ(43,"small",18),e._uU(44,"\u50b3\u771f\u865f\u78bc\u683c\u5f0f\u70ba\uff1a04-66XXXXXX#YYY"),e.qZA()(),e.TgZ(45,"div",21)(46,"label",26),e._uU(47,"\u5e02\u5340\u806f\u7d61\u96fb\u8a71"),e.qZA(),e.TgZ(48,"input",27),e.NdJ("ngModelChange",function(a){return t.unit.tel=a}),e.qZA(),e.TgZ(49,"small",18),e._uU(50,"\u5e02\u5340\u96fb\u8a71\u683c\u5f0f\u70ba\uff1a04-22289111#888"),e.qZA()(),e.TgZ(51,"div",21)(52,"label",28),e._uU(53,"\u6392\u5e8f\u6b04\u4f4d"),e.qZA(),e.TgZ(54,"input",29),e.NdJ("ngModelChange",function(a){return t.unit.weight=a}),e.qZA(),e.TgZ(55,"small",18),e._uU(56,"\u6578\u5b57\u8d8a\u5c0f\u8d8a\u524d\u9762"),e.qZA()()()()()}2&n&&(e.xp6(3),e.Q6J("ngIf",t.message),e.xp6(25),e.Q6J("ngModel",t.unit.code),e.xp6(6),e.Q6J("ngModel",t.unit.displayName),e.xp6(4),e.Q6J("ngModel",t.unit.email),e.xp6(4),e.Q6J("ngModel",t.unit.fax),e.xp6(6),e.Q6J("ngModel",t.unit.tel),e.xp6(6),e.Q6J("ngModel",t.unit.weight))},dependencies:[u.O5,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.nD,l.c5,l.On,l.F]}),i})();function w(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",36)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",37),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",38),e._uU(5,"\xd7"),e.qZA()()()}if(2&i){const n=e.oxw();e.xp6(2),e.Oqu(n.message)}}function Z(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",39)(1,"input",40),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.sex=r)}),e.qZA(),e.TgZ(2,"label",41),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","sex"+n.id)("value",n.value)("ngModel",t.user.sex),e.xp6(1),e.Q6J("for","sex"+n.id),e.xp6(1),e.Oqu(n.label)}}function b(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",39)(1,"input",42),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.enabled=r)}),e.qZA(),e.TgZ(2,"label",41),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","enabled"+n.id)("value",n.value)("ngModel",t.user.enabled),e.xp6(1),e.Q6J("for","enabled"+n.id),e.xp6(1),e.Oqu(n.label)}}function T(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",39)(1,"input",43),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.expired=r)}),e.qZA(),e.TgZ(2,"label",41),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","expired"+n.id)("value",n.value)("ngModel",t.user.expired),e.xp6(1),e.Q6J("for","expired"+n.id),e.xp6(1),e.Oqu(n.label)}}function v(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",39)(1,"input",44),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.expired=r)}),e.qZA(),e.TgZ(2,"label",41),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","locked"+n.id)("value",n.value)("ngModel",t.user.expired),e.xp6(1),e.Q6J("for","locked"+n.id),e.xp6(1),e.Oqu(n.label)}}function x(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",45)(1,"input",46),e.NdJ("change",function(r){const a=e.CHM(n).$implicit,g=e.oxw();return e.KtG(g.onRoleChange(r,a.v1))}),e.qZA(),e.TgZ(2,"label",41),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=s.index,r=e.oxw();e.xp6(1),e.Q6J("id","roles"+t)("value",n.v1)("checked",r.user.roles.includes(n.v1)),e.uIk("data-parsley-required",0===t?"true":null)("data-parsley-mincheck",0===t?"1":null)("data-parsley-class-handler",r.classHandler),e.xp6(1),e.Q6J("for","roles"+t),e.xp6(1),e.Oqu(n.v2)}}let U=(()=>{class i{constructor(n){this.organizationApiService=n,this.switchComponent=new e.vpe,this.refreshTree=new e.vpe,this.message=null,this.messageChange=new e.vpe,this.user={username:"",code:"",confirmCode:"",displayName:"",sex:"none",email:"",tel:"",enabled:!1,expired:!1,locked:!1,unitCode:"",roles:""},this.roleTuples=[],this.classHandler="",this.sexOptions=[{id:1,value:"male",label:"\u7537"},{id:2,value:"female",label:"\u5973"},{id:3,value:"none",label:"\u4e0d\u586b\u7b54"}],this.enabledOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}],this.expiredOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}],this.lockedOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}],this.isInit=!1}ngOnInit(){this.isInit=!0,this.loadUser(this.nodeId)}ngOnChanges(n){this.isInit&&this.loadUser(this.nodeId)}ngAfterViewInit(){this.formInstance=$("#editUserForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(t){return t.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}loadUser(n){this.organizationApiService.getUserForUpdate(n).subscribe(t=>{if("success"===t.status){this.originUser={...t.user},this.user={...t.user},this.roleTuples=[...t.roleTuples];for(let r=0;r<this.roleTuples.length;r++)this.classHandler=0===r?`#roles${r}`:this.classHandler+`,#roles${r}`;this.formInstance&&this.formInstance.reset()}else this.message=t.message})}onSubmit(){this.formInstance.validate()&&this.organizationApiService.updateUser(this.user).subscribe(n=>{this.messageChange.emit(n.message),this.refreshTree.emit({targetNodeId:`user_${this.user.username}`})})}onReset(n){this.user={...this.originUser},n.resetForm(this.user),this.formInstance?.reset()}onDestroy(){confirm("\u78ba\u5b9a\u8981\u522a\u9664\u6b64\u4eba\u54e1\uff1f")&&this.organizationApiService.deleteUser(this.user.username,this.user.unitCode).subscribe(n=>{this.messageChange.emit(n.message),this.refreshTree.emit({targetNodeId:`unit_${this.user.unitCode}`}),this.switchComponent.emit({newComponent:"editUnit",newNodeId:this.user.unitCode})})}onChangePassword(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"editPassword",newNodeId:null})}onUnlock(){this.organizationApiService.unlockErrorPassword(this.user.username).subscribe(n=>{alert("success"===n?"\u89e3\u9664\u9396\u5b9a\u6210\u529f":"failure"===n?"\u89e3\u9664\u9396\u5b9a\u5931\u6557":n)})}onRoleChange(n,t){const r=n.target.checked;let o=this.user.roles?this.user.roles.split(","):[];r?o.includes(t)||o.push(t):o=o.filter(a=>a!==t),this.user.roles=o.join(",")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-edit-user"]],inputs:{nodeId:"nodeId",message:"message"},outputs:{switchComponent:"switchComponent",refreshTree:"refreshTree",messageChange:"messageChange"},features:[e.TTD],decls:71,vars:11,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","toolbar","aria-label","\u529f\u80fd\u9078\u55ae\u7fa4",1,"btn-toolbar","float-right"],["role","group",1,"btn-group","mr-2"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-danger",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-warning",3,"click"],[1,"card-body"],["id","editUserForm","novalidate",""],["userForm","ngForm"],[1,"form-group","required"],["for","username"],["id","username","name","username","type","text","readonly","",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-text","text-muted"],["for","displayName"],["id","displayName","name","displayName","required","","maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group"],["class","custom-control custom-radio",4,"ngFor","ngForOf"],["id","sexError",1,"controlError"],["for","email"],["id","email","name","email","type","email","data-parsley-type","email","maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],["for","tel"],["id","tel","name","tel","type","text","maxlength","128","pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["id","telHelp",1,"form-text","text-muted"],["id","enabledError",1,"controlError"],["id","expiredError",1,"controlError"],["id","lockedError",1,"controlError"],["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],["id","rolesError",1,"controlError"],["type","hidden","id","unitCode","name","unitCode",3,"ngModel","ngModelChange"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"custom-control","custom-radio"],["name","sex","type","radio","data-parsley-class-handler","#sex1,#sex2,#sex3","data-parsley-errors-container","#sexError","required","",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],[1,"custom-control-label",3,"for"],["name","enabled","type","radio","data-parsley-class-handler","#enabled1,#enabled2","data-parsley-errors-container","#enabledError","required","",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],["name","expired","type","radio","data-parsley-class-handler","#expired1,#expired2","data-parsley-errors-container","#expiredError","required","",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],["name","locked","type","radio","data-parsley-class-handler","#locked1,#locked2","data-parsley-errors-container","#lockedError","required","",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],[1,"custom-control","custom-checkbox"],["type","checkbox","name","roles","data-parsley-errors-container","#rolesError",1,"custom-control-input",3,"id","value","checked","change"]],template:function(n,t){if(1&n){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u4fee\u6539\u54e1\u5de5"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,w,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"h6",5)(7,"span"),e._uU(8,"\u54e1\u5de5\u4fee\u6539"),e.qZA(),e.TgZ(9,"div",6)(10,"div",7)(11,"button",8),e.NdJ("click",function(){return t.onSubmit()}),e._uU(12,"\u5132\u5b58"),e.qZA(),e.TgZ(13,"button",9),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(24);return e.KtG(t.onReset(a))}),e._uU(14,"\u91cd\u586b"),e.qZA(),e.TgZ(15,"button",10),e.NdJ("click",function(){return t.onDestroy()}),e._uU(16,"\u522a\u9664"),e.qZA()(),e.TgZ(17,"div",7)(18,"button",11),e.NdJ("click",function(){return t.onChangePassword()}),e._uU(19,"\u4fee\u6539\u5bc6\u78bc"),e.qZA(),e.TgZ(20,"button",12),e.NdJ("click",function(){return t.onUnlock()}),e._uU(21,"\u89e3\u9664\u9396\u5b9a"),e.qZA()()()()(),e.TgZ(22,"div",13)(23,"form",14,15)(25,"div",16)(26,"label",17),e._uU(27,"\u5e33\u865f"),e.qZA(),e.TgZ(28,"input",18),e.NdJ("ngModelChange",function(a){return t.user.username=a}),e.qZA(),e.TgZ(29,"small",19),e._uU(30,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(31,"div",16)(32,"label",20),e._uU(33,"\u59d3\u540d"),e.qZA(),e.TgZ(34,"input",21),e.NdJ("ngModelChange",function(a){return t.user.displayName=a}),e.qZA()(),e.TgZ(35,"div",22)(36,"label"),e._uU(37,"\u6027\u5225"),e.qZA(),e.YNc(38,Z,4,5,"div",23),e._UZ(39,"div",24),e.qZA(),e.TgZ(40,"div",22)(41,"label",25),e._uU(42,"\u96fb\u5b50\u90f5\u4ef6\u4fe1\u7bb1"),e.qZA(),e.TgZ(43,"input",26),e.NdJ("ngModelChange",function(a){return t.user.email=a}),e.qZA()(),e.TgZ(44,"div",22)(45,"label",27),e._uU(46,"\u5e02\u5340\u806f\u7d61\u96fb\u8a71"),e.qZA(),e.TgZ(47,"input",28),e.NdJ("ngModelChange",function(a){return t.user.tel=a}),e.qZA(),e.TgZ(48,"small",29),e._uU(49,"\u5e02\u5340\u96fb\u8a71\u683c\u5f0f\u70ba\uff1a04-22289111#888"),e.qZA()(),e.TgZ(50,"div",22)(51,"label"),e._uU(52,"\u5e33\u865f\u555f\u7528"),e.qZA(),e.YNc(53,b,4,5,"div",23),e._UZ(54,"div",30),e.qZA(),e.TgZ(55,"div",22)(56,"label"),e._uU(57,"\u5bc6\u78bc\u904e\u671f"),e.qZA(),e.YNc(58,T,4,5,"div",23),e._UZ(59,"div",31),e.qZA(),e.TgZ(60,"div",22)(61,"label"),e._uU(62,"\u5e33\u865f\u9396\u5b9a"),e.qZA(),e.YNc(63,v,4,5,"div",23),e._UZ(64,"div",32),e.qZA(),e.TgZ(65,"div",16)(66,"label"),e._uU(67,"\u6240\u5c6c\u89d2\u8272"),e.qZA(),e.YNc(68,x,4,8,"div",33),e._UZ(69,"div",34),e.qZA(),e.TgZ(70,"input",35),e.NdJ("ngModelChange",function(a){return t.user.unitCode=a}),e.qZA()()()()}2&n&&(e.xp6(3),e.Q6J("ngIf",t.message),e.xp6(25),e.Q6J("ngModel",t.user.username),e.xp6(6),e.Q6J("ngModel",t.user.displayName),e.xp6(4),e.Q6J("ngForOf",t.sexOptions),e.xp6(5),e.Q6J("ngModel",t.user.email),e.xp6(4),e.Q6J("ngModel",t.user.tel),e.xp6(6),e.Q6J("ngForOf",t.enabledOptions),e.xp6(5),e.Q6J("ngForOf",t.expiredOptions),e.xp6(5),e.Q6J("ngForOf",t.lockedOptions),e.xp6(5),e.Q6J("ngForOf",t.roleTuples),e.xp6(2),e.Q6J("ngModel",t.user.unitCode))},dependencies:[u.sg,u.O5,l._Y,l.Fj,l._,l.JJ,l.JL,l.Q7,l.nD,l.c5,l.On,l.F]}),i})(),A=(()=>{class i{constructor(n){this.organizationApiService=n,this.switchComponent=new e.vpe,this.refreshTree=new e.vpe,this.message=null,this.messageChange=new e.vpe,this.unit={code:"",displayName:"",fax:"",email:"",tel:"",weight:0,parentCode:this.nodeId}}ngOnInit(){this.organizationApiService.getUnitForCreate(this.nodeId).subscribe(n=>{"success"===n.status?(this.originUnit={...n.unit},this.unit={...n.unit}):this.message=n.message})}ngAfterViewInit(){this.formInstance=$("#newUnitForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(t){return t.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}onSubmit(){const n=this.formInstance.fields.find(t=>"code"===t.$element.attr("name"));n.removeError("zh-tw"),this.organizationApiService.checkUnitCodeRepeat(this.unit.code).subscribe({next:t=>{"empty"!==t?(n.addError("zh-tw",{message:"\u4ee3\u78bc\u4e0d\u53ef\u91cd\u8907"}),n._isValid=!1):(n.removeError("zh-tw"),n._isValid=!0,this.formInstance.validate()&&this.organizationApiService.createUnit(this.unit).subscribe(r=>{this.messageChange.emit(r.message),this.refreshTree.emit({targetNodeId:`unit_${this.unit.code}`,clearSelected:!1}),this.switchComponent.emit({newComponent:"editUnit",newNodeId:this.unit.code})}))},error:()=>{n._errors?.["zh-tw"]&&n.removeError("zh-tw"),n.addError("zh-tw",{message:"\u6aa2\u67e5\u5931\u6557\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66"})}})}onReset(n){this.unit={...this.originUnit},n.resetForm(this.unit),this.formInstance?.reset()}goBack(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"editUnit",newNodeId:null})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-new-unit"]],inputs:{nodeId:"nodeId",message:"message"},outputs:{switchComponent:"switchComponent",refreshTree:"refreshTree",messageChange:"messageChange"},decls:51,vars:7,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","group",1,"btn-group","float-right"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body"],["id","newUnitForm","novalidate",""],["unit1Form","ngForm"],[1,"form-group","required"],["for","code"],["id","code","name","code","type","text","data-parsley-required","true","data-parsley-maxlength","256","data-parsley-english-number-only","","data-parsley-code-repeat","",1,"form-control",3,"ngModel","ngModelChange"],["id","codeHelp",1,"form-text","text-muted"],["for","displayName"],["id","displayName","name","displayName","type","text","data-parsley-required","true","data-parsley-maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group"],["for","email"],["id","email","name","email","type","email","data-parsley-maxlength","256","data-parsley-type","email",1,"form-control",3,"ngModel","ngModelChange"],["for","fax"],["id","fax","name","fax","type","text","data-parsley-maxlength","128","data-parsley-pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["id","faxHelp",1,"form-text","text-muted"],["for","tel"],["id","tel","name","tel","type","text","data-parsley-maxlength","128","data-parsley-pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["id","telHelp",1,"form-text","text-muted"],["for","weight"],["id","weight","name","weight","type","number","data-parsley-type","integer",1,"form-control",3,"ngModel","ngModelChange"],["id","weightHelp",1,"form-text","text-muted"],["type","hidden","id","parentCode","name","parentCode",3,"ngModel","ngModelChange"]],template:function(n,t){if(1&n){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u65b0\u589e\u55ae\u4f4d"),e.qZA(),e._UZ(2,"p",1),e.TgZ(3,"div",2)(4,"div",3)(5,"h6",4)(6,"span"),e._uU(7,"\u55ae\u4f4d\u65b0\u589e"),e.qZA(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return t.onSubmit()}),e._uU(10,"\u5132\u5b58"),e.qZA(),e.TgZ(11,"button",7),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(17);return e.KtG(t.onReset(a))}),e._uU(12,"\u91cd\u586b"),e.qZA(),e.TgZ(13,"button",8),e.NdJ("click",function(){return t.goBack()}),e._uU(14,"\u56de\u4e0a\u9801"),e.qZA()()()(),e.TgZ(15,"div",9)(16,"form",10,11)(18,"div",12)(19,"label",13),e._uU(20,"\u55ae\u4f4d\u4ee3\u78bc"),e.qZA(),e.TgZ(21,"input",14),e.NdJ("ngModelChange",function(a){return t.unit.code=a}),e.qZA(),e.TgZ(22,"small",15),e._uU(23,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(24,"div",12)(25,"label",16),e._uU(26,"\u540d\u7a31"),e.qZA(),e.TgZ(27,"input",17),e.NdJ("ngModelChange",function(a){return t.unit.displayName=a}),e.qZA()(),e.TgZ(28,"div",18)(29,"label",19),e._uU(30,"\u96fb\u5b50\u90f5\u4ef6\u4fe1\u7bb1"),e.qZA(),e.TgZ(31,"input",20),e.NdJ("ngModelChange",function(a){return t.unit.email=a}),e.qZA()(),e.TgZ(32,"div",18)(33,"label",21),e._uU(34,"\u50b3\u771f\u865f\u78bc"),e.qZA(),e.TgZ(35,"input",22),e.NdJ("ngModelChange",function(a){return t.unit.fax=a}),e.qZA(),e.TgZ(36,"small",23),e._uU(37,"\u50b3\u771f\u865f\u78bc\u683c\u5f0f\u70ba\uff1a04-66XXXXXX#YYY"),e.qZA()(),e.TgZ(38,"div",18)(39,"label",24),e._uU(40,"\u5e02\u5340\u806f\u7d61\u96fb\u8a71"),e.qZA(),e.TgZ(41,"input",25),e.NdJ("ngModelChange",function(a){return t.unit.tel=a}),e.qZA(),e.TgZ(42,"small",26),e._uU(43,"\u5e02\u5340\u96fb\u8a71\u683c\u5f0f\u70ba\uff1a04-22289111#888"),e.qZA()(),e.TgZ(44,"div",18)(45,"label",27),e._uU(46,"\u6392\u5e8f\u6b04\u4f4d"),e.qZA(),e.TgZ(47,"input",28),e.NdJ("ngModelChange",function(a){return t.unit.weight=a}),e.qZA(),e.TgZ(48,"small",29),e._uU(49,"\u6578\u5b57\u8d8a\u5c0f\u8d8a\u524d\u9762"),e.qZA()(),e.TgZ(50,"input",30),e.NdJ("ngModelChange",function(a){return t.unit.parentCode=a}),e.qZA()()()()}2&n&&(e.xp6(21),e.Q6J("ngModel",t.unit.code),e.xp6(6),e.Q6J("ngModel",t.unit.displayName),e.xp6(4),e.Q6J("ngModel",t.unit.email),e.xp6(4),e.Q6J("ngModel",t.unit.fax),e.xp6(6),e.Q6J("ngModel",t.unit.tel),e.xp6(6),e.Q6J("ngModel",t.unit.weight),e.xp6(3),e.Q6J("ngModel",t.unit.parentCode))},dependencies:[l._Y,l.Fj,l.wV,l.JJ,l.JL,l.On,l.F]}),i})();function y(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",38)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",39),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",40),e._uU(5,"\xd7"),e.qZA()()()}if(2&i){const n=e.oxw();e.xp6(2),e.Oqu(n.message)}}function M(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",41)(1,"input",42),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.sex=r)}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","sex"+n.id)("value",n.value)("ngModel",t.user.sex),e.xp6(1),e.Q6J("for","sex"+n.id),e.xp6(1),e.Oqu(n.label)}}function E(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",41)(1,"input",44),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.enabled=r)}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","enabled"+n.id)("value",n.value)("ngModel",t.user.enabled),e.xp6(1),e.Q6J("for","enabled"+n.id),e.xp6(1),e.Oqu(n.label)}}function z(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",41)(1,"input",45),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.expired=r)}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","expired"+n.id)("value",n.value)("ngModel",t.user.expired),e.xp6(1),e.Q6J("for","expired"+n.id),e.xp6(1),e.Oqu(n.label)}}function F(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",41)(1,"input",46),e.NdJ("ngModelChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.user.expired=r)}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("id","locked"+n.id)("value",n.value)("ngModel",t.user.expired),e.xp6(1),e.Q6J("for","locked"+n.id),e.xp6(1),e.Oqu(n.label)}}function N(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",47)(1,"input",48),e.NdJ("change",function(r){const a=e.CHM(n).$implicit,g=e.oxw();return e.KtG(g.onRoleChange(r,a.v1))}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&i){const n=s.$implicit,t=s.index,r=e.oxw();e.xp6(1),e.Q6J("id","roles"+t)("value",n.v1)("checked",r.user.roles.includes(n.v1)),e.uIk("data-parsley-required",0===t?"true":null)("data-parsley-mincheck",0===t?"1":null)("data-parsley-class-handler",r.classHandler),e.xp6(1),e.Q6J("for","roles"+t),e.xp6(1),e.Oqu(n.v2)}}let q=(()=>{class i{constructor(n){this.organizationApiService=n,this.switchComponent=new e.vpe,this.refreshTree=new e.vpe,this.message=null,this.messageChange=new e.vpe,this.user={username:"",code:"",confirmCode:"",displayName:"",sex:"none",email:"",tel:"",enabled:!1,expired:!1,locked:!1,unitCode:"",roles:""},this.roleTuples=[],this.classHandler="",this.sexOptions=[{id:1,value:"male",label:"\u7537"},{id:2,value:"female",label:"\u5973"},{id:3,value:"none",label:"\u4e0d\u586b\u7b54"}],this.enabledOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}],this.expiredOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}],this.lockedOptions=[{id:1,value:!0,label:"\u662f"},{id:2,value:!1,label:"\u5426"}]}ngOnInit(){this.organizationApiService.getUserForCreate(this.nodeId).subscribe(n=>{if("success"===n.status){n.user.roles="",this.originUser={...n.user},this.user={...n.user},this.roleTuples=[...n.roleTuples];for(let t=0;t<this.roleTuples.length;t++)this.classHandler=0===t?`#roles${t}`:this.classHandler+`,#roles${t}`}else this.message=n.message})}ngAfterViewInit(){this.formInstance=$("#newUserForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(t){return t.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}onSubmit(){const n=this.formInstance.fields.find(t=>"username"===t.$element.attr("name"));n.removeError("zh-tw"),this.organizationApiService.checkUsernameRepeat(this.user.username).subscribe({next:t=>{"empty"!==t?(n.addError("zh-tw",{message:"\u5e33\u865f\u4e0d\u53ef\u91cd\u8907"}),n._isValid=!1):(n.removeError("zh-tw"),n._isValid=!0,this.formInstance.validate()&&this.organizationApiService.createUser(this.user).subscribe(r=>{this.messageChange.emit(r.message),this.refreshTree.emit({targetNodeId:`user_${this.user.username}`,clearSelected:!1}),this.switchComponent.emit({newComponent:"editUser",newNodeId:this.user.username})}))},error:()=>{n._errors?.["zh-tw"]||n.addError("zh-tw",{message:"\u5e33\u865f\u4e0d\u53ef\u91cd\u8907"}),n.addError("zh-tw",{message:"\u6aa2\u67e5\u5931\u6557\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66"})}})}onReset(n){this.user={...this.originUser},n.resetForm(this.user),this.formInstance?.reset()}goBack(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"editUnit",newNodeId:null})}onRoleChange(n,t){const r=n.target.checked;let o=this.user.roles?this.user.roles.split(","):[];r?o.includes(t)||o.push(t):o=o.filter(a=>a!==t),this.user.roles=o.join(",")}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-new-user"]],inputs:{nodeId:"nodeId",message:"message"},outputs:{switchComponent:"switchComponent",refreshTree:"refreshTree",messageChange:"messageChange"},decls:77,vars:13,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","group",1,"btn-group","float-right"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body"],["id","newUserForm","novalidate",""],["unit1Form","ngForm"],[1,"form-group","required"],["for","username"],["id","username","name","username","type","text","data-parsley-required","true","data-parsley-english-number-only","","data-parsley-maxlength","256","data-parsley-username-repeat","",1,"form-control",3,"ngModel","ngModelChange"],["id","usernameHelp",1,"form-text","text-muted"],["for","code"],["id","code","name","code","type","password","data-parsley-required","true","data-parsley-english-number-only","","data-parsley-minlength","8","data-parsley-maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],["id","passwordHelp",1,"form-text","text-muted"],["for","confirmCode"],["id","confirmCode","name","confirmCode","type","password","data-parsley-required","true","data-parsley-english-number-only","","data-parsley-minlength","8","data-parsley-maxlength","256","data-parsley-equalto","#code",1,"form-control",3,"ngModel","ngModelChange"],["for","displayName"],["id","displayName","name","displayName","type","text","data-parsley-required","true","data-parsley-maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],[1,"form-group"],["class","custom-control custom-radio",4,"ngFor","ngForOf"],["id","sexError",1,"controlError"],["for","email"],["id","email","name","email","type","text","data-parsley-maxlength","256","data-parsley-type","email",1,"form-control",3,"ngModel","ngModelChange"],["for","tel"],["id","tel","name","tel","type","text","data-parsley-maxlength","128","data-parsley-pattern","^[0-9]{2,4}-\\d{7,8}(#\\d{1,6})?$",1,"form-control",3,"ngModel","ngModelChange"],["id","telHelp",1,"form-text","text-muted"],["id","enabledError",1,"controlError"],["id","expiredError",1,"controlError"],["id","lockedError",1,"controlError"],["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],["id","rolesError",1,"controlError"],["type","hidden","id","unitCode","name","unitCode",3,"ngModel","ngModelChange"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"custom-control","custom-radio"],["name","sex","type","radio","data-parsley-required","true","data-parsley-class-handler","#sex1,#sex2,#sex3","data-parsley-errors-container","#sexError",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],[1,"custom-control-label",3,"for"],["name","enabled","type","radio","data-parsley-required","true","data-parsley-class-handler","#enabled1,#enabled2","data-parsley-errors-container","#enabledError",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],["name","expired","type","radio","data-parsley-required","true","data-parsley-class-handler","#expired1,#expired2","data-parsley-errors-container","#expiredError",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],["name","locked","type","radio","data-parsley-required","true","data-parsley-class-handler","#locked1,#locked2","data-parsley-errors-container","#lockedError",1,"custom-control-input",3,"id","value","ngModel","ngModelChange"],[1,"custom-control","custom-checkbox"],["type","checkbox","name","roles","data-parsley-errors-container","#rolesError",1,"custom-control-input",3,"id","value","checked","change"]],template:function(n,t){if(1&n){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u65b0\u589e\u54e1\u5de5"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,y,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"h6",5)(7,"span"),e._uU(8,"\u54e1\u5de5\u65b0\u589e"),e.qZA(),e.TgZ(9,"div",6)(10,"button",7),e.NdJ("click",function(){return t.onSubmit()}),e._uU(11,"\u5132\u5b58"),e.qZA(),e.TgZ(12,"button",8),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(18);return e.KtG(t.onReset(a))}),e._uU(13,"\u91cd\u586b"),e.qZA(),e.TgZ(14,"button",9),e.NdJ("click",function(){return t.goBack()}),e._uU(15,"\u56de\u4e0a\u9801"),e.qZA()()()(),e.TgZ(16,"div",10)(17,"form",11,12)(19,"div",13)(20,"label",14),e._uU(21,"\u5e33\u865f"),e.qZA(),e.TgZ(22,"input",15),e.NdJ("ngModelChange",function(a){return t.user.username=a}),e.qZA(),e.TgZ(23,"small",16),e._uU(24,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(25,"div",13)(26,"label",17),e._uU(27,"\u5bc6\u78bc"),e.qZA(),e.TgZ(28,"input",18),e.NdJ("ngModelChange",function(a){return t.user.code=a}),e.qZA(),e.TgZ(29,"small",19),e._uU(30,"\u5bc6\u78bc\u9700\u70ba8\u4f4d\u4ee5\u4e0a\u7684\u82f1\u6578\u5b57\u7d44\u5408"),e.qZA()(),e.TgZ(31,"div",13)(32,"label",20),e._uU(33,"\u5bc6\u78bc\u78ba\u8a8d"),e.qZA(),e.TgZ(34,"input",21),e.NdJ("ngModelChange",function(a){return t.user.confirmCode=a}),e.qZA(),e.TgZ(35,"small",19),e._uU(36,"\u5bc6\u78bc\u78ba\u8a8d\uff0c\u8acb\u518d\u8f38\u5165\u5bc6\u78bc\u4e00\u6b21"),e.qZA()(),e.TgZ(37,"div",13)(38,"label",22),e._uU(39,"\u59d3\u540d"),e.qZA(),e.TgZ(40,"input",23),e.NdJ("ngModelChange",function(a){return t.user.displayName=a}),e.qZA()(),e.TgZ(41,"div",24)(42,"label"),e._uU(43,"\u6027\u5225"),e.qZA(),e.YNc(44,M,4,5,"div",25),e._UZ(45,"div",26),e.qZA(),e.TgZ(46,"div",24)(47,"label",27),e._uU(48,"\u96fb\u5b50\u90f5\u4ef6\u4fe1\u7bb1"),e.qZA(),e.TgZ(49,"input",28),e.NdJ("ngModelChange",function(a){return t.user.email=a}),e.qZA()(),e.TgZ(50,"div",24)(51,"label",29),e._uU(52,"\u5e02\u5340\u806f\u7d61\u96fb\u8a71"),e.qZA(),e.TgZ(53,"input",30),e.NdJ("ngModelChange",function(a){return t.user.tel=a}),e.qZA(),e.TgZ(54,"small",31),e._uU(55,"\u5e02\u5340\u96fb\u8a71\u683c\u5f0f\u70ba\uff1a04-22289111#888"),e.qZA()(),e.TgZ(56,"div",24)(57,"label"),e._uU(58,"\u5e33\u865f\u555f\u7528"),e.qZA(),e.YNc(59,E,4,5,"div",25),e._UZ(60,"div",32),e.qZA(),e.TgZ(61,"div",24)(62,"label"),e._uU(63,"\u5bc6\u78bc\u904e\u671f"),e.qZA(),e.YNc(64,z,4,5,"div",25),e._UZ(65,"div",33),e.qZA(),e.TgZ(66,"div",24)(67,"label"),e._uU(68,"\u5e33\u865f\u9396\u5b9a"),e.qZA(),e.YNc(69,F,4,5,"div",25),e._UZ(70,"div",34),e.qZA(),e.TgZ(71,"div",13)(72,"label"),e._uU(73,"\u6240\u5c6c\u89d2\u8272"),e.qZA(),e.YNc(74,N,4,8,"div",35),e._UZ(75,"div",36),e.qZA(),e.TgZ(76,"input",37),e.NdJ("ngModelChange",function(a){return t.user.unitCode=a}),e.qZA()()()()}2&n&&(e.xp6(3),e.Q6J("ngIf",t.message),e.xp6(19),e.Q6J("ngModel",t.user.username),e.xp6(6),e.Q6J("ngModel",t.user.code),e.xp6(6),e.Q6J("ngModel",t.user.confirmCode),e.xp6(6),e.Q6J("ngModel",t.user.displayName),e.xp6(4),e.Q6J("ngForOf",t.sexOptions),e.xp6(5),e.Q6J("ngModel",t.user.email),e.xp6(4),e.Q6J("ngModel",t.user.tel),e.xp6(6),e.Q6J("ngForOf",t.enabledOptions),e.xp6(5),e.Q6J("ngForOf",t.expiredOptions),e.xp6(5),e.Q6J("ngForOf",t.lockedOptions),e.xp6(5),e.Q6J("ngForOf",t.roleTuples),e.xp6(2),e.Q6J("ngModel",t.user.unitCode))},dependencies:[u.sg,u.O5,l._Y,l.Fj,l._,l.JJ,l.JL,l.On,l.F]}),i})();function O(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"div",25)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",26),e.NdJ("click",function(){e.CHM(n);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",27),e._uU(5,"\xd7"),e.qZA()()()}if(2&i){const n=e.oxw();e.xp6(2),e.Oqu(n.message)}}let J=(()=>{class i{constructor(n){this.organizationApiService=n,this.switchComponent=new e.vpe,this.message=null,this.messageChange=new e.vpe,this.passwordModel={username:"",displayName:"",code:"",confirmCode:""}}ngOnInit(){this.loadUser(this.nodeId)}ngAfterViewInit(){this.formInstance=$("#editPasswordForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(t){return t.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}loadUser(n){this.organizationApiService.getPasswordForUpdate(n).subscribe(t=>{"success"===t.status?(this.originPasswordModel={...t.passwordModel},this.passwordModel={...t.passwordModel},this.formInstance&&this.formInstance.reset(),this.message=null):this.message=t.message})}onSubmit(){this.formInstance.validate()&&this.organizationApiService.updatePassword(this.passwordModel).subscribe(n=>{this.messageChange.emit(n.message),this.switchComponent.emit({newComponent:"editUser",newNodeId:null})})}onReset(n){this.passwordModel={...this.originPasswordModel},n.resetForm(this.passwordModel),this.formInstance?.reset()}goBack(){this.messageChange.emit(null),this.switchComponent.emit({newComponent:"editUser",newNodeId:null})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-edit-password"]],inputs:{nodeId:"nodeId",message:"message"},outputs:{switchComponent:"switchComponent",messageChange:"messageChange"},decls:41,vars:5,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","group","aria-label","\u529f\u80fd\u9078\u55ae\u7fa4",1,"btn-group","float-right"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body"],["id","editPasswordForm","novalidate",""],["passswordForm","ngForm"],[1,"form-group","required"],["for","username"],["id","username","name","username","type","text","readonly","readonly",1,"form-control",3,"ngModel","ngModelChange"],["id","usernameHelp",1,"form-text","text-muted"],["for","displayName"],["id","displayName","name","displayName","type","text","readonly","readonly",1,"form-control",3,"ngModel","ngModelChange"],["for","code"],["id","code","name","code","type","password","data-parsley-required","true","data-parsley-english-number-only","","data-parsley-minlength","8","data-parsley-maxlength","256",1,"form-control",3,"ngModel","ngModelChange"],["id","passwordHelp",1,"form-text","text-muted"],["for","confirmCode"],["id","confirmCode","name","confirmCode","type","password","data-parsley-required","true","data-parsley-english-number-only","","data-parsley-minlength","8","data-parsley-maxlength","256","data-parsley-equalto","#code",1,"form-control",3,"ngModel","ngModelChange"],["id","confirmPasswordHelp",1,"form-text","text-muted"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"]],template:function(n,t){if(1&n){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u4fee\u6539\u5bc6\u78bc"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,O,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"h6",5)(7,"span"),e._uU(8,"\u54e1\u5de5\u65b0\u589e"),e.qZA(),e.TgZ(9,"div",6)(10,"button",7),e.NdJ("click",function(){return t.onSubmit()}),e._uU(11,"\u5132\u5b58"),e.qZA(),e.TgZ(12,"button",8),e.NdJ("click",function(){e.CHM(r);const a=e.MAs(18);return e.KtG(t.onReset(a))}),e._uU(13,"\u91cd\u586b"),e.qZA(),e.TgZ(14,"button",9),e.NdJ("click",function(){return t.goBack()}),e._uU(15,"\u56de\u4e0a\u9801"),e.qZA()()()(),e.TgZ(16,"div",10)(17,"form",11,12)(19,"div",13)(20,"label",14),e._uU(21,"\u5e33\u865f"),e.qZA(),e.TgZ(22,"input",15),e.NdJ("ngModelChange",function(a){return t.passwordModel.username=a}),e.qZA(),e.TgZ(23,"small",16),e._uU(24,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(25,"div",13)(26,"label",17),e._uU(27,"\u59d3\u540d"),e.qZA(),e.TgZ(28,"input",18),e.NdJ("ngModelChange",function(a){return t.passwordModel.displayName=a}),e.qZA()(),e.TgZ(29,"div",13)(30,"label",19),e._uU(31,"\u5bc6\u78bc"),e.qZA(),e.TgZ(32,"input",20),e.NdJ("ngModelChange",function(a){return t.passwordModel.code=a}),e.qZA(),e.TgZ(33,"small",21),e._uU(34,"\u5bc6\u78bc\u9700\u70ba8\u4f4d\u4ee5\u4e0a\u7684\u82f1\u6578\u5b57\u7d44\u5408"),e.qZA()(),e.TgZ(35,"div",13)(36,"label",22),e._uU(37,"\u5bc6\u78bc\u78ba\u8a8d"),e.qZA(),e.TgZ(38,"input",23),e.NdJ("ngModelChange",function(a){return t.passwordModel.confirmCode=a}),e.qZA(),e.TgZ(39,"small",24),e._uU(40,"\u5bc6\u78bc\u78ba\u8a8d\uff0c\u8acb\u518d\u8f38\u5165\u5bc6\u78bc\u4e00\u6b21"),e.qZA()()()()()}2&n&&(e.xp6(3),e.Q6J("ngIf",t.message),e.xp6(19),e.Q6J("ngModel",t.passwordModel.username),e.xp6(6),e.Q6J("ngModel",t.passwordModel.displayName),e.xp6(4),e.Q6J("ngModel",t.passwordModel.code),e.xp6(6),e.Q6J("ngModel",t.passwordModel.confirmCode))},dependencies:[u.O5,l._Y,l.Fj,l.JJ,l.JL,l.On,l.F]}),i})();function I(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"app-organization-edit-unit",17),e.NdJ("messageChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.message=r)})("switchComponent",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onSwitchComponent(r.newComponent,r.newNodeId))})("refreshTree",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onRefreshTree(r.targetNodeId))}),e.qZA()}if(2&i){const n=e.oxw();e.Q6J("nodeId",n.selectedNodeId)("message",n.message)}}function B(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"app-organization-new-unit",17),e.NdJ("messageChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.message=r)})("switchComponent",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onSwitchComponent(r.newComponent,r.newNodeId))})("refreshTree",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onRefreshTree(r.targetNodeId))}),e.qZA()}if(2&i){const n=e.oxw();e.Q6J("nodeId",n.selectedNodeId)("message",n.message)}}function k(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"app-organization-edit-user",17),e.NdJ("messageChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.message=r)})("switchComponent",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onSwitchComponent(r.newComponent,r.newNodeId))})("refreshTree",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onRefreshTree(r.targetNodeId))}),e.qZA()}if(2&i){const n=e.oxw();e.Q6J("nodeId",n.selectedNodeId)("message",n.message)}}function D(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"app-organization-new-user",17),e.NdJ("messageChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.message=r)})("switchComponent",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onSwitchComponent(r.newComponent,r.newNodeId))})("refreshTree",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onRefreshTree(r.targetNodeId))}),e.qZA()}if(2&i){const n=e.oxw();e.Q6J("nodeId",n.selectedNodeId)("message",n.message)}}function Q(i,s){if(1&i){const n=e.EpF();e.TgZ(0,"app-organization-edit-password",18),e.NdJ("messageChange",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.message=r)})("switchComponent",function(r){e.CHM(n);const o=e.oxw();return e.KtG(o.onSwitchComponent(r.newComponent,r.newNodeId))}),e.qZA()}if(2&i){const n=e.oxw();e.Q6J("nodeId",n.selectedNodeId)("message",n.message)}}function H(i,s){1&i&&e._UZ(0,"div")}const S=[{path:"index",component:(()=>{class i{constructor(n,t){this.assetLoader=n,this.organizationApiService=t,this.message=null,this.targetId=null,this.currentComponent=null,this.selectedNodeId=""}ngOnInit(){}ngAfterViewInit(){this.assetLoader.loadAssets(["assets/sb-admin/vendor/jstree/jstree.min.js","assets/sb-admin/vendor/iframe-resizer/iframeResizer.min.js","assets/sb-admin/vendor/application/customValidator.js"],["assets/sb-admin/vendor/jstree/themes/default/style.min.css"]).then(()=>{this.initJsTree(),this.resizeIframe()})}onSwitchComponent(n,t){this.currentComponent=n,t&&(this.selectedNodeId=t)}exportExcel(){this.organizationApiService.downloadReport().subscribe(n=>{const t=document.createElement("a"),r=URL.createObjectURL(n);t.href=r,t.download="\u4eba\u54e1\u7d44\u7e54\u5831\u8868.xls",t.click(),URL.revokeObjectURL(r)})}onRefreshTree(n){this.targetId=n,$("#organizationTree").jstree(!0).refresh()}initJsTree(){const n=this;$("#organizationTree").jstree({core:{data:function(t,r){n.organizationApiService.getMenuTree(t.id).subscribe({next:o=>{r(o)},error:o=>{console.error("jsTree error",o)}})},multiple:!1,themes:{dots:!0,stripes:!1,responsive:!1,variant:"large"}}}).on("refresh.jstree",function(t,r){return r.instance._data.core.selected&&r.instance._data.core.selected.length>0&&(console.log("open >> "+r.instance._data.core.selected[0]),$("#organizationTree").jstree(!0).open_node(r.instance._data.core.selected[0])),null!=n.targetId&&($("#organizationTree").jstree(!0).deselect_all(!0),$("#organizationTree").jstree(!0).select_node(n.targetId,!0,!0),n.targetId=null),!1}).on("select_node.jstree",function(t,r){var o=r.node;if(n.targetId){if(n.targetId!=o.id){const a=n.targetId.split("_");"unit"===a[0]?(n.currentComponent="editUnit",n.selectedNodeId=n.targetId.replace("unit_","")):"user"===a[0]?(n.currentComponent="editUser",n.selectedNodeId=n.targetId.replace("user_","")):(n.currentComponent=null,n.selectedNodeId="")}}else n.message=null,"unit"===o.data?(n.currentComponent="editUnit",n.selectedNodeId=o.id.replace("unit_","")):"user"===o.data?(n.currentComponent="editUser",n.selectedNodeId=o.id.replace("user_","")):(n.currentComponent=null,n.selectedNodeId="")})}resizeIframe(){const n=-1!==navigator.userAgent.indexOf("MSIE");$("#mainframe").iFrameResize({heightCalculationMethod:n?"max":"lowestElement",checkOrigin:!1})}}return i.\u0275fac=function(n){return new(n||i)(e.Y36(h.s),e.Y36(p))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-organization-index"]],decls:25,vars:6,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],[1,"form-inline","mt-3",2,"flex-direction","row-reverse"],["id","excel","type","submit",1,"excel","btn","btn-primary","ml-2","mb-2","mr-2",3,"click"],[1,"card-body"],[1,"row"],[1,"col-auto"],[1,"mb-2","title","text-info"],["id","organizationTree"],["id","contentFrame",1,"col"],[3,"ngSwitch"],[3,"nodeId","message","messageChange","switchComponent","refreshTree",4,"ngSwitchCase"],[3,"nodeId","message","messageChange","switchComponent",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"nodeId","message","messageChange","switchComponent","refreshTree"],[3,"nodeId","message","messageChange","switchComponent"]],template:function(n,t){1&n&&(e.TgZ(0,"h1",0),e._uU(1,"\u4eba\u54e1\u7d44\u7e54"),e.qZA(),e._UZ(2,"div",1),e.TgZ(3,"div",2)(4,"div",3)(5,"h6",4)(6,"span"),e._uU(7,"\u4eba\u54e1\u7d44\u7e54"),e.qZA(),e.TgZ(8,"div",5)(9,"button",6),e.NdJ("click",function(){return t.exportExcel()}),e._uU(10,"\u532f\u51faxls\u5831\u8868"),e.qZA()()()(),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"h6",10),e._uU(15,"\u4eba\u54e1\u7d44\u7e54\u6a39"),e.qZA(),e._UZ(16,"div",11),e.qZA(),e.TgZ(17,"div",12),e.ynx(18,13),e.YNc(19,I,1,2,"app-organization-edit-unit",14),e.YNc(20,B,1,2,"app-organization-new-unit",14),e.YNc(21,k,1,2,"app-organization-edit-user",14),e.YNc(22,D,1,2,"app-organization-new-user",14),e.YNc(23,Q,1,2,"app-organization-edit-password",15),e.YNc(24,H,1,0,"div",16),e.BQk(),e.qZA()()()()),2&n&&(e.xp6(18),e.Q6J("ngSwitch",t.currentComponent),e.xp6(1),e.Q6J("ngSwitchCase","editUnit"),e.xp6(1),e.Q6J("ngSwitchCase","newUnit"),e.xp6(1),e.Q6J("ngSwitchCase","editUser"),e.xp6(1),e.Q6J("ngSwitchCase","newUser"),e.xp6(1),e.Q6J("ngSwitchCase","editPassword"))},dependencies:[u.RF,u.n9,u.ED,f,U,A,q,J]}),i})()},{path:"",redirectTo:"index",pathMatch:"full"}];let Y=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.Bz.forChild(S),m.Bz]}),i})(),R=(()=>{class i{}return i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.ez,Y,l.u5]}),i})()}}]);
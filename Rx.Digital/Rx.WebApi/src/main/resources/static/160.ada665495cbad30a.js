"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[160],{9160:(E,p,d)=>{d.r(p),d.d(p,{PermissionModule:()=>Z});var m=d(6895),c=d(1387),e=d(8256),h=d(2812),u=d(433);function g(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"div",20)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",21),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",22),e._uU(5,"\xd7"),e.qZA()()()}if(2&s){const t=e.oxw();e.xp6(2),e.Oqu(t.message)}}let f=(()=>{class s{constructor(t){this.assetLoader=t,this.message=null,this.queryUsername=""}ngOnInit(){this.message=history.state.message||null}ngAfterViewInit(){this.assetLoader.loadAssets(["assets/sb-admin/vendor/datatables/jquery.dataTables.min.js"],[]).then(()=>this.assetLoader.loadAssets(["assets/sb-admin/vendor/datatables/dataTables.bootstrap4.min.js","assets/sb-admin/vendor/datatables/springify.js"],["assets/sb-admin/vendor/datatables/dataTables.bootstrap4.min.css"])).then(()=>{this.initDataTable()})}initDataTable(){var t=$("#dataTable").DataTable({language:{url:"assets/sb-admin/vendor/datatables/Chinese-traditional.json"},processing:!0,serverSide:!0,searching:!1,ajax:{url:"/angular/permission/query",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")||0},data:this.springify},order:[],columns:[{name:"index",data:null,width:"10%",orderable:!1,searchable:!1,render:function(n,r,o,i){var l=t.page.len();return t.page.info().page*l+i.row+1}},{name:"unitName",data:"unitName",orderable:!1,searchable:!1},{name:"displayName",data:"displayName",orderable:!1,searchable:!1},{name:"username",data:"username",width:"20%",orderable:!0,searchable:!0,render:(n,r,o,i)=>`<a href="/manage/permission/edit?username=${n}" title="\u4fee\u6539\u6b0a\u9650">${n}</a>`},{name:"roles",data:"roles",orderable:!1,searchable:!0}]})}springify(t,n){Array.isArray(t.columns)&&(t.columns.forEach((i,l)=>{t[`columns[${l}].index`]=l,t[`columns[${l}].data`]=i.data,t[`columns[${l}].name`]=i.name,t[`columns[${l}].searchable`]=i.searchable,t[`columns[${l}].orderable`]=i.orderable,t[`columns[${l}].search.regex`]=i.search?.regex,t[`columns[${l}].search.value`]=i.search?.value}),delete t.columns),Array.isArray(t.order)&&(t.order.forEach((i,l)=>{t[`order[${l}].column`]=i.column,t[`order[${l}].dir`]=i.dir}),delete t.order),t.search&&(t["search.regex"]=t.search.regex,t["search.value"]=t.search.value,delete t.search),$("#filterForm");var o=$("#queryUsername").val();return o&&""!==o&&(t.queryUsername=o),t}ngOnDestroy(){$("#dataTable").DataTable().destroy(!0)}onQuery(){$("#dataTable").DataTable().ajax.reload()}onReset(){this.queryUsername=""}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(h.s))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-permission-index"]],decls:36,vars:2,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4","mr-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],["id","filterForm","method","post"],[1,"m-0","font-weight-bold","text-primary"],[1,"row"],[1,"col-sm-5"],[1,"form-group"],["for","qryEmail",1,"control-label"],["type","text","name","queryUsername","id","queryUsername",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-sm-12"],[1,"btn","btn-success","mb-2",3,"click"],[1,"btn","btn-info","ml-2","mb-2",3,"click"],[1,"card-body"],[1,"table-responsive"],["id","dataTable","width","100%","cellspacing","0",1,"table","table-bordered","table-striped"],["width","10%"],["width","20%"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"]],template:function(t,n){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"\u6b0a\u9650\u8a2d\u5b9a"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,g,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"form",5)(7,"h6",6)(8,"div",7)(9,"div",8)(10,"div",9)(11,"label",10),e._uU(12,"\u4f7f\u7528\u8005\u5e33\u865f"),e.qZA(),e.TgZ(13,"input",11),e.NdJ("ngModelChange",function(o){return n.queryUsername=o}),e.qZA()()()(),e.TgZ(14,"div",7)(15,"div",12)(16,"button",13),e.NdJ("click",function(){return n.onQuery()}),e._uU(17,"\u67e5\u8a62"),e.qZA(),e.TgZ(18,"button",14),e.NdJ("click",function(){return n.onReset()}),e._uU(19,"\u6e05\u9664"),e.qZA()()()()()(),e.TgZ(20,"div",15)(21,"div",16)(22,"table",17)(23,"thead")(24,"tr")(25,"th",18),e._uU(26,"\u5e8f\u865f"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"\u55ae\u4f4d"),e.qZA(),e.TgZ(29,"th"),e._uU(30,"\u59d3\u540d"),e.qZA(),e.TgZ(31,"th",19),e._uU(32,"\u4f7f\u7528\u8005\u5e33\u865f"),e.qZA(),e.TgZ(33,"th"),e._uU(34,"\u96b8\u5c6c\u89d2\u8272"),e.qZA()()(),e._UZ(35,"tbody"),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("ngIf",n.message),e.xp6(10),e.Q6J("ngModel",n.queryUsername))},dependencies:[m.O5,u._Y,u.Fj,u.JJ,u.JL,u.On,u.F]}),s})();var b=d(529);let _=(()=>{class s{constructor(t){this.http=t,this.url="/angular/permission"}getPermissionForUpdate(t){return this.http.get(`${this.url}/edit`,{params:{username:t}})}updatePermission(t){return this.http.post(`${this.url}/update`,t)}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(b.eN))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function v(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"div",24)(1,"strong"),e._uU(2),e.qZA(),e.TgZ(3,"button",25),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.message=null)}),e.TgZ(4,"span",26),e._uU(5,"\xd7"),e.qZA()()()}if(2&s){const t=e.oxw();e.xp6(2),e.Oqu(t.message)}}function y(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"div",27)(1,"input",28),e.NdJ("change",function(r){const i=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onRoleChange(r,i.v1))}),e.qZA(),e.TgZ(2,"label",29),e._uU(3),e.qZA()()}if(2&s){const t=a.$implicit,n=a.index,r=e.oxw();e.xp6(1),e.Q6J("id","roles"+n)("value",t.v1)("checked",r.user.roles.includes(t.v1)),e.uIk("data-parsley-required",0===n?"true":null)("data-parsley-mincheck",0===n?"1":null)("data-parsley-class-handler",r.classHandler),e.xp6(1),e.Q6J("for","roles"+n),e.xp6(1),e.Oqu(t.v2)}}const T=[{path:"index",component:f},{path:"edit",component:(()=>{class s{constructor(t,n,r){this.permissionApiService=t,this.router=n,this.route=r,this.message=null,this.username="",this.unitName="",this.user={username:"",code:"",confirmCode:"",displayName:"",sex:"none",email:"",tel:"",enabled:!1,expired:!1,locked:!1,unitCode:"",roles:""},this.roleTuples=[],this.classHandler=""}ngOnInit(){const t=new URLSearchParams(window.location.search);t.has("username")&&(this.username=t.get("username")),this.permissionApiService.getPermissionForUpdate(this.username).subscribe(n=>{if("success"===n.status){this.originUser={...n.user},this.user={...n.user},this.roleTuples=[...n.roleTuples],this.unitName=n.unitName;for(let r=0;r<this.roleTuples.length;r++)this.classHandler=0===r?`#roles${r}`:this.classHandler+`,#roles${r}`;this.formInstance&&this.formInstance.reset()}else this.message=n.message})}ngAfterViewInit(){this.initForm()}initForm(){this.formInstance=$("#userForm").parsley({errorClass:"is-invalid",successClass:"is-valid",classHandler:function(n){return n.$element},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:"<div></div>"})}onSubmit(){this.formInstance.validate()&&this.permissionApiService.updatePermission(this.user).subscribe(t=>{this.message=t.message,"success"===t.status&&this.router.navigate(["../index"],{relativeTo:this.route,state:{message:this.message}})})}onReset(t){this.user={...this.originUser},t.resetForm(this.user),this.formInstance?.reset()}goBack(){this.router.navigate(["../index"],{relativeTo:this.route})}onRoleChange(t,n){const r=t.target.checked;let o=this.user.roles?this.user.roles.split(","):[];r?o.includes(n)||o.push(n):o=o.filter(i=>i!==n),this.user.roles=o.join(",")}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(_),e.Y36(c.F0),e.Y36(c.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-permission-edit"]],decls:39,vars:6,consts:[[1,"h3","mb-2","text-gray-800"],[1,"mb-4"],["class","alert alert-primary alert-dismissible fade show","role","alert",4,"ngIf"],[1,"card","shadow","mb-4"],[1,"card-header","py-3"],[1,"m-0","font-weight-bold","text-primary"],["role","group","aria-label","\u529f\u80fd\u9078\u55ae",1,"btn-group","float-right"],["type","submit",1,"btn","btn-warning",3,"click"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body"],["id","userForm","novalidate",""],["userForm","ngForm"],[1,"form-group","required"],["for","unitName"],["id","unitName","name","unitName","type","text","readonly","readonly",1,"form-control",3,"ngModel","ngModelChange"],["for","username"],["id","username","name","username","type","text","readonly","readonly",1,"form-control",3,"ngModel","ngModelChange"],["id","usernameHelp",1,"form-text","text-muted"],["for","displayName"],["id","displayName","name","displayName","type","text","readonly","readonly",1,"form-control",3,"ngModel","ngModelChange"],["class","custom-control custom-checkbox",4,"ngFor","ngForOf"],["id","rolesError",1,"controlError"],["type","hidden","id","unitCode","name","unitCode",3,"ngModel","ngModelChange"],["role","alert",1,"alert","alert-primary","alert-dismissible","fade","show"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"custom-control","custom-checkbox"],["type","checkbox","name","roles","data-parsley-errors-container","#rolesError",1,"custom-control-input",3,"id","value","checked","change"],[1,"custom-control-label",3,"for"]],template:function(t,n){if(1&t){const r=e.EpF();e.TgZ(0,"h1",0),e._uU(1,"\u4fee\u6539\u6b0a\u9650"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,v,6,1,"div",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"h6",5)(7,"span"),e._uU(8,"\u6b0a\u9650\u4fee\u6539"),e.qZA(),e.TgZ(9,"div",6)(10,"button",7),e.NdJ("click",function(){return n.onSubmit()}),e._uU(11,"\u5132\u5b58"),e.qZA(),e.TgZ(12,"button",8),e.NdJ("click",function(){e.CHM(r);const i=e.MAs(18);return e.KtG(n.onReset(i))}),e._uU(13,"\u91cd\u586b"),e.qZA(),e.TgZ(14,"button",9),e.NdJ("click",function(){return n.goBack()}),e._uU(15,"\u56de\u4e0a\u9801"),e.qZA()()()(),e.TgZ(16,"div",10)(17,"form",11,12)(19,"div",13)(20,"label",14),e._uU(21,"\u6240\u5c6c\u55ae\u4f4d"),e.qZA(),e.TgZ(22,"input",15),e.NdJ("ngModelChange",function(i){return n.unitName=i}),e.qZA()(),e.TgZ(23,"div",13)(24,"label",16),e._uU(25,"\u5e33\u865f"),e.qZA(),e.TgZ(26,"input",17),e.NdJ("ngModelChange",function(i){return n.user.username=i}),e.qZA(),e.TgZ(27,"small",18),e._uU(28,"\u4ee3\u78bc\u9700\u70ba\u82f1\u6587\u548c\u6578\u5b57\uff0c\u4e0d\u53ef\u91cd\u8907"),e.qZA()(),e.TgZ(29,"div",13)(30,"label",19),e._uU(31,"\u59d3\u540d"),e.qZA(),e.TgZ(32,"input",20),e.NdJ("ngModelChange",function(i){return n.user.displayName=i}),e.qZA()(),e.TgZ(33,"div",13)(34,"label"),e._uU(35,"\u6240\u5c6c\u89d2\u8272"),e.qZA(),e.YNc(36,y,4,8,"div",21),e._UZ(37,"div",22),e.qZA(),e.TgZ(38,"input",23),e.NdJ("ngModelChange",function(i){return n.user.unitCode=i}),e.qZA()()()()}2&t&&(e.xp6(3),e.Q6J("ngIf",n.message),e.xp6(19),e.Q6J("ngModel",n.unitName),e.xp6(4),e.Q6J("ngModel",n.user.username),e.xp6(6),e.Q6J("ngModel",n.user.displayName),e.xp6(4),e.Q6J("ngForOf",n.roleTuples),e.xp6(2),e.Q6J("ngModel",n.user.unitCode))},dependencies:[m.sg,m.O5,u._Y,u.Fj,u.JJ,u.JL,u.On,u.F]}),s})()},{path:"",redirectTo:"index",pathMatch:"full"}];let C=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[c.Bz.forChild(T),c.Bz]}),s})(),Z=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[m.ez,C,u.u5]}),s})()}}]);
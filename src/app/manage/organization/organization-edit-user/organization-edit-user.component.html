<h1 class="h3 mb-2 text-gray-800">修改員工</h1>
<div class="mb-4">
    <div *ngIf="message" class="alert alert-primary alert-dismissible fade show" role="alert">
        <strong>{{ message }}</strong>
        <button type="button" class="close" (click)="message = null" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
</div>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            <span>員工修改</span>
            <div class="btn-toolbar float-right" role="toolbar" aria-label="功能選單群">
                <div class="btn-group mr-2" role="group">
                    <button type="submit" class="btn btn-warning" (click)="onSubmit()">儲存</button>
                    <button type="button" class="btn btn-info" (click)="onReset(userForm)">重填</button>
                    <button type="button" class="btn btn-danger" (click)="onDestroy()">刪除</button>
                </div>
                <div class="btn-group mr-2" role="group">
                    <button type="button" class="btn btn-primary" (click)="onChangePassword()">修改密碼</button>
                    <button type="button" class="btn btn-warning" (click)="onUnlock()">解除鎖定</button>
                </div>
            </div>
        </h6>
    </div>

    <div class="card-body">
        <form id="editUserForm" #userForm="ngForm" novalidate>
            <div class="form-group required">
                <label for="username">帳號</label>
                <input id="username" name="username" class="form-control" type="text" [(ngModel)]="user.username"
                    readonly />
                <small class="form-text text-muted">代碼需為英文和數字，不可重複</small>
            </div>

            <div class="form-group required">
                <label for="displayName">姓名</label>
                <input id="displayName" name="displayName" class="form-control" [(ngModel)]="user.displayName" required
                    maxlength="256" />
            </div>

            <div class="form-group">
                <label>性別</label>
                <div *ngFor="let s of sexOptions" class="custom-control custom-radio">
                    <input [id]="'sex' + s.id" [value]="s.value" name="sex" type="radio" class="custom-control-input"
                        data-parsley-class-handler="#sex1,#sex2,#sex3"
                        data-parsley-errors-container="#sexError"
                        [(ngModel)]="user.sex" required />
                    <label class="custom-control-label" [for]="'sex' + s.id">{{ s.label }}</label>
                </div>
                <div id="sexError" class="controlError"></div>
            </div>

            <div class="form-group">
                <label for="email">電子郵件信箱</label>
                <input id="email" name="email" class="form-control" type="email" [(ngModel)]="user.email"
                    data-parsley-type="email"
                    maxlength="256" />
            </div>

            <div class="form-group">
                <label for="tel">市區聯絡電話</label>
                <input id="tel" name="tel" class="form-control" type="text" [(ngModel)]="user.tel" maxlength="128"
                    pattern="^[0-9]{2,4}-\d{7,8}(#\d{1,6})?$" />
                <small id="telHelp" class="form-text text-muted">市區電話格式為：04-22289111#888</small>
            </div>

            <!-- 帳號啟用 -->
            <div class="form-group">
                <label>帳號啟用</label>
                <div *ngFor="let s of enabledOptions" class="custom-control custom-radio">
                    <input [id]="'enabled' + s.id" [value]="s.value" name="enabled" type="radio" class="custom-control-input"
                        data-parsley-class-handler="#enabled1,#enabled2"
                        data-parsley-errors-container="#enabledError"
                        [(ngModel)]="user.enabled" required />
                    <label class="custom-control-label" [for]="'enabled' + s.id">{{ s.label }}</label>
                </div>
                <div id="enabledError" class="controlError"></div>
            </div>

            <!-- 密碼過期 -->
            <div class="form-group">
                <label>密碼過期</label>
                <div *ngFor="let s of expiredOptions" class="custom-control custom-radio">
                    <input [id]="'expired' + s.id" [value]="s.value" name="expired" type="radio" class="custom-control-input"
                        data-parsley-class-handler="#expired1,#expired2"
                        data-parsley-errors-container="#expiredError"
                        [(ngModel)]="user.expired" required />
                    <label class="custom-control-label" [for]="'expired' + s.id">{{ s.label }}</label>
                </div>
                <div id="expiredError" class="controlError"></div>
            </div>

            <!-- 帳號鎖定 -->
            <div class="form-group">
                <label>帳號鎖定</label>
                <div *ngFor="let s of lockedOptions" class="custom-control custom-radio">
                    <input [id]="'locked' + s.id" [value]="s.value" name="locked" type="radio" class="custom-control-input"
                        data-parsley-class-handler="#locked1,#locked2"
                        data-parsley-errors-container="#lockedError"
                        [(ngModel)]="user.expired" required />
                    <label class="custom-control-label" [for]="'locked' + s.id">{{ s.label }}</label>
                </div>
                <div id="lockedError" class="controlError"></div>
            </div>

            <!-- 角色勾選 -->
            <div class="form-group required">
                <label>所屬角色</label>
                <div *ngFor="let role of roleTuples; let i = index" class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" [id]="'roles' + i" [value]="role.v1"
                        name="roles" [checked]="user.roles.includes(role.v1)"
                        (change)="onRoleChange($event, role.v1)"
                        [attr.data-parsley-required]="i === 0 ? 'true' : null"
                        [attr.data-parsley-mincheck]="i === 0 ? '1' : null"
                        [attr.data-parsley-class-handler]="classHandler"
                        data-parsley-errors-container="#rolesError"/>
                    <label class="custom-control-label" [for]="'roles' + i">{{ role.v2 }}</label>
                </div>
                <div id="rolesError" class="controlError"></div>
            </div>
            <input type="hidden" id="unitCode" name="unitCode" [(ngModel)]="user.unitCode">
        </form>
    </div>
</div>